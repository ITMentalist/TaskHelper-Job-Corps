Option Explicit 'Forces explicit declaration of all variables

'===============================
' # NavigateB2B (Module)
'
'Navigates through the AS400's most common PS screens to reach the _
BNIMAIN homescreen.  True if success; False if failure.
'
'Warning: Implementation of this script requires testing before _
applying to a new application.
'
' To-Do List: _
1 - This approach is terribly inefficient; must re-write _
2 - Find a better approach to handling non-B2B screens; encountering _
a non-B2B screen not handled by the CASE switch may crash Excel _
3 - Align procedures with Best Practices
'==================================================================================

Public Function Nav_To_Home_Screen(objAS400 As Object) As Boolean

'Note: The AS/400 will only accept variable numbers as long
Dim byt_Counter, byt_Maximum As Byte    'Stores loop information
Dim get_text As String        'Stores search string
Dim str_date As String           'Stores current date
Dim milliseconds As Long

milliseconds = 30

'Maximum number of attempts
byt_Maximum = 5

byt_Counter = 0
get_text = vbNullString
str_date = vbNullString

'This date string helps identify certain B2C PS screens
str_date = Format(Now, "m/dd/yy")

'Sets the overall function to False
If Not Debugger Then On Error GoTo PathError Else On Error GoTo 0

Call WaitForReady(objAS400, milliseconds)

If objAS400.autECLPS.SearchText(str_date, 2, 2, 80) Then
    GoTo SkipLoop
ElseIf objAS400.autECLPS.SearchText("dialer", 1, 9, 50) Then
    GoTo SkipLoop
End If

Do
    Call WaitForReady(objAS400, milliseconds)
    get_text = objAS400.autECLPS.GetText(1, 2, 8)
    Call WaitForReady(objAS400, milliseconds)
        
    Select Case get_text
        
        Case " BNIMAIN"     'PS: BNIMAIN (Destination)
            Nav_To_Home_Screen = True
            Exit Do
                
        Case " BNICS  "     'PS: BNICS
            objAS400.autECLPS.SendKeys ("[pf12]")
            Nav_To_Home_Screen = True
            Exit Do
                
        Case "603131_B"     'PS: Student Service Inquiry (1.14.)
            objAS400.autECLPS.SendKeys ("[pf3]")
            Call WaitForReady(objAS400, milliseconds)
                
        Case "603132_B"     'PS: (1.14.), Education Services Inquiry
            objAS400.autECLPS.SendKeys ("[pf3]")
            Call WaitForReady(objAS400, milliseconds)
                
        Case "01051   "     'Address Book Information
            objAS400.autECLPS.SendKeys ("[pf3]")
            Call WaitForReady(objAS400, milliseconds)
                
        Case " 032002 "     'PS: (1.14.), Customer Ledger Inquiry
            objAS400.autECLPS.SendKeys ("[pf3]")
            Call WaitForReady(objAS400, milliseconds)
                
        Case "631001  "     'PS: (1.14.), ICS Cancellation Maintenance
            objAS400.autECLPS.SendKeys ("[pf3]")
            Call WaitForReady(objAS400, milliseconds)
                
        Case "60110   "     'PS: (1.14.), Student Supplemental
            objAS400.autECLPS.SendKeys ("[pf3]")
            Call WaitForReady(objAS400, milliseconds)
                
        Case "60210   "     'PS: (1.14.), Student Course Master
            objAS400.autECLPS.SendKeys ("[pf3]")
            Call WaitForReady(objAS400, milliseconds)
                
        Case "42045   "     'PS: (1.14.), Shipping Screen
            objAS400.autECLPS.SendKeys ("[pf3]")
            Call WaitForReady(objAS400, milliseconds)
                
        Case " ICSACCT"     'PS: ICS Accounting Main Menu
            objAS400.autECLPS.SendKeys ("[pf12]")
            Call WaitForReady(objAS400, milliseconds)
                
        Case "ICSMAIN "     'PS: Main Menu
            objAS400.autECLPS.SetText "6", 20, 7
            objAS400.autECLPS.SendKeys ("[Enter]")
            Call WaitForReady(objAS400, milliseconds)
                
        Case " 98VL   "     'Library List Selection
            objAS400.autECLPS.SetText "1", 6, 10
            objAS400.autECLPS.SendKeys ("[Enter]")
            Call WaitForReady(objAS400, milliseconds)
                
        Case " BNIPROD"
            objAS400.autECLPS.SendKeys ("[pf12]")
            Call WaitForReady(objAS400, milliseconds)
            objAS400.autECLPS.SendKeys ("[pf12]")
            Call WaitForReady(objAS400, milliseconds)
                
        Case "        "     'No tag
            objAS400.autECLPS.SendKeys ("[Enter]")
            Call WaitForReady(objAS400, milliseconds)
            objAS400.autECLPS.SendKeys ("[Enter]")
            Call WaitForReady(objAS400, milliseconds)
            objAS400.autECLPS.SendKeys ("[Enter]")
            Call WaitForReady(objAS400, milliseconds)
                
            If objAS400.autECLPS.SearchText("ICSMAIN", 1, 2) Then
                objAS400.autECLPS.SetText "6", 20, 7
                Call WaitForReady(objAS400, milliseconds)
            End If
                
        End Select
        
    byt_Counter = byt_Counter + 1
        
Loop Until byt_Counter >= byt_Maximum
    
If byt_Counter >= byt_Maximum Then Nav_To_Home_Screen = False

Cleanup:

Exit Function

'///////////////////
'Error/GoTo Handlers
'///////////////////

SkipLoop:
Nav_To_Home_Screen = False
GoTo Cleanup

PathError:
Nav_To_Home_Screen = False
Resume Cleanup

End Function

